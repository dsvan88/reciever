<?php
require __DIR__.'/action.class.php';

$action = new Action();

$action->query(
    str_replace('{TABLE_MAIN}', TABLE_MAIN,
        "CREATE TABLE IF NOT EXISTS {TABLE_MAIN} (
            id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
            name CHARACTER VARYING(100) NOT NULL DEFAULT '',
            contact CHARACTER VARYING(100) NOT NULL DEFAULT '',
            email CHARACTER VARYING(100) NOT NULL DEFAULT '',
            message TEXT NULL DEFAULT NULL,
            time int NOT NULL DEFAULT 0,
            status CHARACTER VARYING(20) NOT NULL DEFAULT 'new'
        );"
    )
);

$action->query(
    str_replace('{TABLE_USERS}', TABLE_USERS,
        "CREATE TABLE IF NOT EXISTS {TABLE_USERS} (
            id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
            login CHARACTER VARYING(80) NOT NULL DEFAULT '',
            password CHARACTER VARYING(100) NOT NULL DEFAULT ''
        );"
    )
);

if (!$action->recordExists(['login'=>'admin'],TABLE_USERS)){
    $action->rowInsert(['login'=>'admin', 'password' => '$2y$10$nrFt674uOjlgALrZBfu4nu6a4f8bX1h/rmoe2A.2kPUNspmObnl4q'],TABLE_USERS);
}

echo 'Done!';